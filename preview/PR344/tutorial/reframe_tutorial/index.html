
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ukri-excalibur.github.io/excalibur-tests/preview/PR344/tutorial/reframe_tutorial/">
      
      
        <link rel="prev" href="../getting-started/">
      
      
        <link rel="next" href="../excalibur-tests_tutorial/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.1">
    
    
      
        <title>Writing benchmarks in ReFrame - ExCALIBUR-tests Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#automating-benchmarks-with-reframe" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ExCALIBUR-tests Docs" class="md-header__button md-logo" aria-label="ExCALIBUR-tests Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ExCALIBUR-tests Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Writing benchmarks in ReFrame
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ukri-excalibur/excalibur-tests" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ExCALIBUR-tests Docs" class="md-nav__button md-logo" aria-label="ExCALIBUR-tests Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ExCALIBUR-tests Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ukri-excalibur/excalibur-tests" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../use/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../post-processing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Post-processing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Supported Benchmarks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Supported Benchmarks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Synthetic Benchmarks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            Synthetic Benchmarks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/hpl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HPL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/imb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IMB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/omb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OMB
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mini-apps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Mini-apps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/hpcg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hpcg
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/hpgmg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hpgmg
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/sombrero/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sombrero
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/babelstream/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    babelstream
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Applications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/cp2k/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cp2k
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/grid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    grid
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/openmm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    openmm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/ramses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ramses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/sphng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sphng
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/swift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    swift
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/trove/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    trove
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/trove-pdsyev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    trove-pdsyev
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apps/wrf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wrf
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Supported Systems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Supported Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../systems#archer2" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ARCHER2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../systems#csd3" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSD3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../systems#cosma" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cosma
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../systems#dial2" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DIaL2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../systems#dial3" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DIaL3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../systems#isambard-2" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Isambard 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../systems#myriad-and-kathleen" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Myriad
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../systems#myriad-and-kathleen" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kathleen
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../systems#tursa" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tursa
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Writing benchmarks in ReFrame
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Writing benchmarks in ReFrame
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#outline" class="md-nav__link">
    <span class="md-ellipsis">
      Outline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-reframe-executes-tests" class="md-nav__link">
    <span class="md-ellipsis">
      How ReFrame executes tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-python-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Set up python environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-reframe" class="md-nav__link">
    <span class="md-ellipsis">
      Install ReFrame
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hello-world-example" class="md-nav__link">
    <span class="md-ellipsis">
      Hello world example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hello world example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#include-reframe-module" class="md-nav__link">
    <span class="md-ellipsis">
      Include ReFrame module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-test-class" class="md-nav__link">
    <span class="md-ellipsis">
      Create a Test Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-mandatory-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Add mandatory attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-sanity-check" class="md-nav__link">
    <span class="md-ellipsis">
      Add sanity check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      Run the benchmark
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#builtin-programming-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Builtin programming environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-reframe-for-hpc-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring ReFrame for HPC systems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Performance tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-test-class" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Test Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-cloning-the-source" class="md-nav__link">
    <span class="md-ellipsis">
      Git Cloning the source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-stream-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      Building the STREAM benchmark
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-sanity-check_1" class="md-nav__link">
    <span class="md-ellipsis">
      Add Sanity Check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-performance-pattern-check" class="md-nav__link">
    <span class="md-ellipsis">
      Add Performance Pattern Check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#perflogs" class="md-nav__link">
    <span class="md-ellipsis">
      Perflogs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-values" class="md-nav__link">
    <span class="md-ellipsis">
      Reference values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parametrized-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Parametrized tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Build systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make" class="md-nav__link">
    <span class="md-ellipsis">
      Make
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autotools" class="md-nav__link">
    <span class="md-ellipsis">
      Autotools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cmake" class="md-nav__link">
    <span class="md-ellipsis">
      CMake
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spack" class="md-nav__link">
    <span class="md-ellipsis">
      Spack
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-only-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Run-only tests
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../excalibur-tests_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automation in excalibur-tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../postprocessing_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Postprocessing ReFrame output
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../profiling_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profiling benchmarks
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#outline" class="md-nav__link">
    <span class="md-ellipsis">
      Outline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-reframe-executes-tests" class="md-nav__link">
    <span class="md-ellipsis">
      How ReFrame executes tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-python-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Set up python environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-reframe" class="md-nav__link">
    <span class="md-ellipsis">
      Install ReFrame
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hello-world-example" class="md-nav__link">
    <span class="md-ellipsis">
      Hello world example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hello world example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#include-reframe-module" class="md-nav__link">
    <span class="md-ellipsis">
      Include ReFrame module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-test-class" class="md-nav__link">
    <span class="md-ellipsis">
      Create a Test Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-mandatory-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Add mandatory attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-sanity-check" class="md-nav__link">
    <span class="md-ellipsis">
      Add sanity check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      Run the benchmark
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#builtin-programming-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Builtin programming environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-reframe-for-hpc-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring ReFrame for HPC systems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Performance tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-test-class" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Test Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-cloning-the-source" class="md-nav__link">
    <span class="md-ellipsis">
      Git Cloning the source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-stream-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      Building the STREAM benchmark
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-sanity-check_1" class="md-nav__link">
    <span class="md-ellipsis">
      Add Sanity Check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-performance-pattern-check" class="md-nav__link">
    <span class="md-ellipsis">
      Add Performance Pattern Check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#perflogs" class="md-nav__link">
    <span class="md-ellipsis">
      Perflogs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-values" class="md-nav__link">
    <span class="md-ellipsis">
      Reference values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parametrized-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Parametrized tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Build systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make" class="md-nav__link">
    <span class="md-ellipsis">
      Make
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autotools" class="md-nav__link">
    <span class="md-ellipsis">
      Autotools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cmake" class="md-nav__link">
    <span class="md-ellipsis">
      CMake
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spack" class="md-nav__link">
    <span class="md-ellipsis">
      Spack
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-only-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Run-only tests
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="automating-benchmarks-with-reframe">Automating benchmarks with ReFrame</h1>
<h2 id="outline">Outline</h2>
<ol>
<li>How ReFrame executes tests</li>
<li>Structure of a ReFrame test -- Hello world example</li>
<li>Configuring ReFrame to run tests on HPC systems</li>
<li>Writing performance tests -- Stream example</li>
<li>Working with build systems -- Make, CMake, Autotools, Spack examples</li>
<li>Avoiding build systems -- Run-only tests</li>
</ol>
<p>This tutorial is adapted from <a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/tutorials.html">ReFrame 4.5 tutorials</a>, that also cover more ReFrame features. Direct quotes from the tutorial are marked with</p>
<blockquote>
<p>ReFrame Tutorials</p>
</blockquote>
<p>There's a <a href="https://reframe-hpc.readthedocs.io/en/v4.6.0/tutorial.html">new tutorial</a> with a slightly different approach in ReFrame 4.6.</p>
<hr />
<h2 id="how-reframe-executes-tests">How ReFrame executes tests</h2>
<p>When ReFrame executes a test it runs a pipeline of the following stages</p>
<p><img alt="" src="https://reframe-hpc.readthedocs.io/en/stable/_images/pipeline.svg" /></p>
<p>You can customise the behaviour of each stage or add a hook before or after each of them.  For more details, read the <a href="https://reframe-hpc.readthedocs.io/en/stable/pipeline.html">ReFrame pipeline documentation</a>.</p>
<hr />
<h2 id="set-up-python-environment">Set up python environment</h2>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Cosma</label><label for="__tabbed_1_2">ARCHER2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>This tutorial is run on the <a href="https://cosma.readthedocs.io/en/latest/">Cosma</a> supercomputer.
It should be straightforward to run on a different platform, the requirements are  <code>gcc 4.5</code>, <code>git 2.39</code> and <code>python 3.7</code>. 
(for the later parts you also need <code>make</code>, <code>autotools</code>, <code>cmake</code> and <code>spack</code> but these can be installed locally).
Before proceeding to install ReFrame, we recommend creating a python virtual environment to avoid clashes with other installed python packages.
First load a newer python module.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>module<span class="w"> </span>swap<span class="w"> </span>python/3.10.12
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p>This tutorial is run on ARCHER2, you should have signed up for a training account before starting.
It can be ran on other HPC systems with a batch scheduler but will require making some changes to the config.
Before proceeding to install ReFrame, we recommend creating a python virtual environment to avoid clashes with other installed python packages.
First load the system python module.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>module<span class="w"> </span>load<span class="w"> </span>cray-python
</span></code></pre></div></p>
</div>
</div>
</div>
<p>Then create an environment and activate it with</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>reframe_tutorial
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nb">source</span><span class="w"> </span>reframe_tutorial/bin/activate
</span></code></pre></div>
<p>You will have to activate the environment each time you login. To deactivate the environment run <code>deactivate</code>.</p>
<hr />
<h2 id="install-reframe">Install ReFrame</h2>
<p>Then install ReFrame with <code>pip</code>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>pip<span class="w"> </span>install<span class="w"> </span>reframe-hpc
</span></code></pre></div>
<p>Alternatively, you can</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>git<span class="w"> </span>clone<span class="w"> </span>-q<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>--branch<span class="w"> </span>v4.5.2<span class="w"> </span>https://github.com/reframe-hpc/reframe.git
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nb">source</span><span class="w"> </span>reframe/bootstrap.sh
</span></code></pre></div>
<p>You can also clone the ReFrame git repository to get the source code of the ReFrame tutorials.
We will refer to some of the tutorial solutions later.
ReFrame rewrote their tutorials in v4.6 and some of the examples we are using are not there anymore,
therefore it's best to clone ReFrame v4.5.</p>
<hr />
<h2 id="hello-world-example">Hello world example</h2>
<p>There's a <a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/tutorial_basics.html#the-hello-world-test">Hello world example</a> in the ReFrame 4.5 tutorial that explains how to create a simple ReFrame test.</p>
<p>ReFrame tests are python classes that describe how a test is run.
To get started, open an empty <code>.py</code> file where you will write the ReFrame class, e.g. <code>hello.py</code>.</p>
<hr />
<h3 id="include-reframe-module">Include ReFrame module</h3>
<p>The first thing you need is to include ReFrame.
We separately import sanity to simplify the syntax.
These should be available if the installation step was successful.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reframe</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rfm</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reframe.utility.sanity</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sn</span>
</span></code></pre></div>
<hr />
<h3 id="create-a-test-class">Create a Test Class</h3>
<p>ReFrame uses decorators to mark classes as tests.
This marks <code>class HelloTest</code> as a <code>rfm.simple_test</code>.
ReFrame tests ultimately derive from <code>RegressionTest</code>.
There are other derived classes such as <code>RunOnlyRegressionTest</code>, we get to those later.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">HelloTest</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">RegressionTest</span><span class="p">):</span>
</span></code></pre></div>
<p>The data members and methods detailed in the following sections should be placed inside this class.</p>
<hr />
<h3 id="add-mandatory-attributes">Add mandatory attributes</h3>
<ul>
<li><code>valid_systems</code> for where this test can run. For now we haven't defined any systems so we leave it as <code>'*'</code> (any system)</li>
<li><code>valid_prog_environs</code> for what compilers this test can build with. More on it later.</li>
<li>In a test with a single source file, it is enough to define <code>sourcepath</code>. More on build systems later.</li>
<li>We could add <code>sourcesdir</code> to point to the source directory, but it defaults to <code>src/</code></li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">sourcepath</span> <span class="o">=</span> <span class="s1">&#39;hello.c&#39;</span>
</span></code></pre></div>
<hr />
<h3 id="add-sanity-check">Add sanity check</h3>
<ul>
<li>ReFrame, by default, makes no assumption about whether a test is successful or not.</li>
<li>A test must provide a validation function that asserts whether the test was successful</li>
<li>ReFrame provides utility functions that help matching patterns and extract values from the test’s output</li>
<li>Here we match a string from stdout</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>    <span class="nd">@sanity_function</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assert_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>        <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_found</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Hello, World\!&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="run-the-benchmark">Run the benchmark</h3>
<p>The basic syntax to run ReFrame benchmarks is</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>reframe<span class="w"> </span>-c<span class="w"> </span>path/to/benchmark<span class="w"> </span>-r
</span></code></pre></div>
<hr />
<h2 id="builtin-programming-environment">Builtin programming environment</h2>
<p>We didn't tell reframe anything about how to compile the hello world example. How did it compile?
ReFrame uses a buitin programming environment by default.
You can see this with <code>reframe --show-config</code>
The builtin programming environment only contains the <code>cc</code> compiler,
compiling a C++ or Fortran code will fail</p>
<hr />
<h2 id="configuring-reframe-for-hpc-systems">Configuring ReFrame for HPC systems</h2>
<blockquote>
<p>In ReFrame, all the details of the various interactions of a test with the system environment are handled transparently and are set up in its <a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/tutorial_basics.html#more-of-hello-world">configuration file</a>.</p>
</blockquote>
<p>For the minimum configuration to run jobs on the system we need to</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Cosma</label><label for="__tabbed_2_2">ARCHER2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Create a system with a name and a description</li>
<li>Set the module system for accessing centrally installed modules</li>
<li>Create a compute node partition</li>
<li>Set a scheduler and a MPI launcher to run on compute nodes<ul>
<li>On Cosma, the scheduler rejects jobs that don't set a time limit. Add <code>time_limit = 1m</code> to ReFrame tests to run on Cosma or set from command line with <code>-S time_limit='1m'</code></li>
</ul>
</li>
<li>Set access options
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>&#39;access&#39;: [&#39;--partition=bluefield1&#39;, &#39;--account=do009&#39;],
</span></code></pre></div></li>
<li>Create at least one programming environment to set compilers</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">site_configuration</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="s1">&#39;systems&#39;</span> <span class="p">:</span> <span class="p">[</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>        <span class="p">{</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;cosma&#39;</span><span class="p">,</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Cosma for performance workshop&#39;</span><span class="p">,</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>            <span class="s1">&#39;hostnames&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;login[0-9][a-z].pri.cosma[0-9].alces.network&#39;</span><span class="p">],</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>            <span class="s1">&#39;modules_system&#39;</span><span class="p">:</span> <span class="s1">&#39;tmod4&#39;</span><span class="p">,</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>            <span class="s1">&#39;partitions&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>                <span class="p">{</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;compute-node&#39;</span><span class="p">,</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>                    <span class="s1">&#39;scheduler&#39;</span><span class="p">:</span> <span class="s1">&#39;slurm&#39;</span><span class="p">,</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>                    <span class="s1">&#39;launcher&#39;</span><span class="p">:</span> <span class="s1">&#39;mpiexec&#39;</span><span class="p">,</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>                    <span class="s1">&#39;environs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gnu&#39;</span><span class="p">],</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>                    <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;--partition=bluefield1&#39;</span><span class="p">,</span> <span class="s1">&#39;--account=do009&#39;</span><span class="p">],</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>                <span class="p">}</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>            <span class="p">]</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        <span class="p">}</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>    <span class="p">],</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>    <span class="s1">&#39;environments&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>        <span class="p">{</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;gnu&#39;</span><span class="p">,</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>            <span class="s1">&#39;modules&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gnu_comp&#39;</span><span class="p">,</span> <span class="s1">&#39;openmpi&#39;</span><span class="p">],</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>            <span class="s1">&#39;cc&#39;</span><span class="p">:</span> <span class="s1">&#39;mpicc&#39;</span><span class="p">,</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>            <span class="s1">&#39;cxx&#39;</span><span class="p">:</span> <span class="s1">&#39;mpic++&#39;</span><span class="p">,</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>            <span class="s1">&#39;ftn&#39;</span><span class="p">:</span> <span class="s1">&#39;mpif90&#39;</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>        <span class="p">},</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>    <span class="p">]</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<ul>
<li>Create a system with a name and a description</li>
<li>Set the module system for accessing centrally installed modules</li>
<li>Create a compute node partition</li>
<li>Set a scheduler and a MPI launcher to run on compute nodes</li>
<li>Set access options with 
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>&#39;access&#39;: [&#39;--partition=standard&#39;, &#39;--qos=short&#39;],
</span></code></pre></div></li>
<li>Create at least one programming environment to set compilers</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">site_configuration</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="s1">&#39;systems&#39;</span> <span class="p">:</span> <span class="p">[</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>        <span class="p">{</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;archer2&#39;</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;ARCHER2 config for CIUK workshop&#39;</span><span class="p">,</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>            <span class="s1">&#39;hostnames&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ln[0-9]+&#39;</span><span class="p">],</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>            <span class="s1">&#39;partitions&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>                <span class="p">{</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;compute-node&#39;</span><span class="p">,</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>                    <span class="s1">&#39;scheduler&#39;</span><span class="p">:</span> <span class="s1">&#39;slurm&#39;</span><span class="p">,</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>                    <span class="s1">&#39;launcher&#39;</span><span class="p">:</span> <span class="s1">&#39;srun&#39;</span><span class="p">,</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>                    <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;--partition=standard&#39;</span><span class="p">,</span> <span class="s1">&#39;--qos=short&#39;</span><span class="p">],</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>                    <span class="s1">&#39;environs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cray&#39;</span><span class="p">],</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>                <span class="p">}</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>            <span class="p">]</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>        <span class="p">}</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>    <span class="p">],</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>    <span class="s1">&#39;environments&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>        <span class="p">{</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;cray&#39;</span><span class="p">,</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>            <span class="s1">&#39;cc&#39;</span><span class="p">:</span> <span class="s1">&#39;mpicc&#39;</span><span class="p">,</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>            <span class="s1">&#39;cxx&#39;</span><span class="p">:</span> <span class="s1">&#39;mpic++&#39;</span><span class="p">,</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>            <span class="s1">&#39;ftn&#39;</span><span class="p">:</span> <span class="s1">&#39;mpif90&#39;</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>        <span class="p">},</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>    <span class="p">]</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<h2 id="performance-tests">Performance tests</h2>
<p>Performance tests capture data in performance variables. For simplicity, we use the <a href="https://github.com/jeffhammond/STREAM">STREAM benchmark</a> as an example. It is the de facto memory bandwidth benchmark. It has four kernels that stream arrays from memory and
perform different floating point operations on them.
- Copy: <code>A = B</code>
- Scale: <code>C = a * B</code>
- Add: <code>C = A + B</code>
- Triad: <code>C = a * A + B</code></p>
<hr />
<h3 id="create-the-test-class">Create the Test Class</h3>
<p>The imports and the class declaration look the same as in the hello world example. 
We can now specify valid systems and programming environments to run on the system we just configured. 
You can adapt these to your system, or keep using <code>'*'</code> to run on any platform.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Cosma</label><label for="__tabbed_3_2">ARCHER2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reframe</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rfm</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reframe.utility.sanity</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sn</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">StreamTest</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">RegressionTest</span><span class="p">):</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cosma&#39;</span><span class="p">]</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gnu&#39;</span><span class="p">]</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reframe</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rfm</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reframe.utility.sanity</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sn</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">StreamTest</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">RegressionTest</span><span class="p">):</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;archer2&#39;</span><span class="p">]</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cray&#39;</span><span class="p">]</span>
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<h3 id="git-cloning-the-source">Git Cloning the source</h3>
<p>We can retrieve specifically a Git repository by assigning its URL directly to the sourcesdir attribute:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>    <span class="n">sourcesdir</span><span class="o">=</span><span class="s1">&#39;https://github.com/jeffhammond/STREAM&#39;</span>
</span></code></pre></div>
<hr />
<h3 id="environment-variables">Environment variables</h3>
<p>We can set environment variables in the <code>env_vars</code> dictionary.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">env_vars</span><span class="p">[</span><span class="s1">&#39;OMP_NUM_THREADS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">env_vars</span><span class="p">[</span><span class="s1">&#39;OMP_PLACES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cores&#39;</span>
</span></code></pre></div>
<hr />
<h3 id="building-the-stream-benchmark">Building the STREAM benchmark</h3>
<p>Recall the pipeline ReFrame executes when running a test. 
We can insert arbitrary functions between any steps in in the pipeline by decorating them with <code>@run_before</code> or <code>@run_after</code>
Here we can set compiler flags before compiling.
The STREAM benchmark takes the array size as a compile time argument. 
It should be large enough to overflow all levels of cache so that there is no data reuse and we measure the main memory bandwidth.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>    <span class="n">build_system</span><span class="o">=</span><span class="s1">&#39;SingleSource&#39;</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>    <span class="n">sourcepath</span><span class="o">=</span><span class="s1">&#39;stream.c&#39;</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>    <span class="n">arraysize</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">20</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="nd">@run_before</span><span class="p">(</span><span class="s1">&#39;compile&#39;</span><span class="p">)</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_compiler_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">cppflags</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;-DSTREAM_ARRAY_SIZE=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arraysize</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">cflags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-fopenmp&#39;</span><span class="p">,</span> <span class="s1">&#39;-O3&#39;</span><span class="p">]</span>
</span></code></pre></div>
<hr />
<h3 id="add-sanity-check_1">Add Sanity Check</h3>
<p>The rest of the benchmark follows the <a href="https://reframe-hpc.readthedocs.io/en/latest/tutorial_basics.html#writing-a-performance-test">Writing a Performance Test ReFrame Tutorial</a>. First we need a sanity check that ensures the benchmark ran successfully. A function decorated with the <code>@sanity_function</code> decorator is used by ReFrame to check that the test ran successfully. The sanity function can perform a number of checks, in this case we want to match a line of the expected standard output.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nd">@sanity_function</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_found</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Solution Validates&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h3 id="add-performance-pattern-check">Add Performance Pattern Check</h3>
<p>To record the performance of the benchmark, ReFrame should extract a figure of merit from the output of the test. A function decorated with the <code>@performance_function</code> decorator extracts or computes a performance metric from the test’s output.</p>
<blockquote>
<p>In this example, we extract four performance variables, namely the memory bandwidth values for each of the “Copy”, “Scale”, “Add” and “Triad” sub-benchmarks of STREAM, where each of the performance functions use the <a href="https://reframe-hpc.readthedocs.io/en/latest/deferrable_functions_reference.html#reframe.utility.sanity.extractsingle"><code>extractsingle()</code></a> utility function. For each of the sub-benchmarks we extract the “Best Rate MB/s” column of the output (see below) and we convert that to a float.</p>
</blockquote>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nd">@performance_function</span><span class="p">(</span><span class="s1">&#39;MB/s&#39;</span><span class="p">,</span> <span class="n">perf_key</span><span class="o">=</span><span class="s1">&#39;Copy&#39;</span><span class="p">)</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_copy_perf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>    <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">extractsingle</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Copy:\s+(\S+)\s+.*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="nd">@performance_function</span><span class="p">(</span><span class="s1">&#39;MB/s&#39;</span><span class="p">,</span> <span class="n">perf_key</span><span class="o">=</span><span class="s1">&#39;Scale&#39;</span><span class="p">)</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_scale_perf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">extractsingle</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Scale:\s+(\S+)\s+.*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="nd">@performance_function</span><span class="p">(</span><span class="s1">&#39;MB/s&#39;</span><span class="p">,</span> <span class="n">perf_key</span><span class="o">=</span><span class="s1">&#39;Add&#39;</span><span class="p">)</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_add_perf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>    <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">extractsingle</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Add:\s+(\S+)\s+.*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="nd">@performance_function</span><span class="p">(</span><span class="s1">&#39;MB/s&#39;</span><span class="p">,</span> <span class="n">perf_key</span><span class="o">=</span><span class="s1">&#39;Triad&#39;</span><span class="p">)</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_triad_perf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>    <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">extractsingle</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Triad:\s+(\S+)\s+.*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h3 id="perflogs">Perflogs</h3>
<p>The output from performance tests is written in perflogs. They are csv files that are appended each time a test is ran. By default the perflogs are output in <code>perflogs/&lt;system&gt;/&lt;partition&gt;</code>. By default a lot of information about the test is stored. This can be customized in the configuration file.
By default there is not much information about build step, but ReFrame will provide a link back to build environment. A more verbose report is written in <code>.reframe/reports/</code>, you can use the <code>--report-file</code> option to direct the report to a different file.</p>
<p><code>excalibur-tests</code> provides tools to read and process the perflogs. See the <a href="../excalibur-tests_tutorial/">Next Tutorial</a> for details.</p>
<hr />
<h2 id="reference-values">Reference values</h2>
<p>ReFrame can automate checking that the results fall within an expected range. You can set a different reference value for each <code>perf_key</code> in the performance function. For example, set the test to fail if it falls outside of +-25% of the values obtained with the previous array size.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Cosma</label><label for="__tabbed_4_2">Archer2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">reference</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    <span class="s1">&#39;cosma&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>        <span class="s1">&#39;Copy&#39;</span><span class="p">:</span>  <span class="p">(</span><span class="mi">40000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">),</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>        <span class="s1">&#39;Scale&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">20000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">),</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>        <span class="s1">&#39;Add&#39;</span><span class="p">:</span>   <span class="p">(</span><span class="mi">20000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">),</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>        <span class="s1">&#39;Triad&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">20000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">)</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>    <span class="p">}</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">reference</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    <span class="s1">&#39;archer2&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>        <span class="s1">&#39;Copy&#39;</span><span class="p">:</span>  <span class="p">(</span><span class="mi">260000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">),</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>        <span class="s1">&#39;Scale&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">200000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">),</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>        <span class="s1">&#39;Add&#39;</span><span class="p">:</span>   <span class="p">(</span><span class="mi">200000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">),</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>        <span class="s1">&#39;Triad&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">200000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">)</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="p">}</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<blockquote>
<p>The performance reference tuple consists of the reference value, the lower and upper thresholds expressed as fractional numbers relative to the reference value, and the unit of measurement. If any of the thresholds is not relevant, None may be used instead. Also, the units in this reference variable are entirely optional, since they were already provided through the @performance_function decorator.</p>
</blockquote>
<hr />
<h2 id="parametrized-tests">Parametrized tests</h2>
<p>You can pass a list to the <code>parameter()</code> built-in function in the class body to create a parametrized test. You cannot access the individual parameter value within the class body, so any reference to them should be placed in the appropriate function, for example <code>__init__()</code></p>
<p>For parametrisation you can add for example
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>    <span class="n">arraysize</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">25</span><span class="p">])</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">cppflags</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;-DSTREAM_ARRAY_SIZE=$((2 ** </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arraysize</span><span class="si">}</span><span class="s1">))&#39;</span><span class="p">]</span>
</span></code></pre></div></p>
<p>You can have multiple parameters. ReFrame will run all parameter combinations by default.</p>
<hr />
<h2 id="build-systems"><a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/tutorial_advanced.html#more-on-building-tests">Build systems</a></h2>
<p>ReFrame supports many commonly used build systems, include Cmake, Autotools, Spack and Easybuild. See the
<a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/regression_test_api.html#build-systems">Build systems Reference</a> for details.
Here we show a few examples.</p>
<hr />
<h3 id="make"><a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/tutorial_advanced.html#more-on-building-tests">Make</a></h3>
<ul>
<li><a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/tutorial_advanced.html#more-on-building-tests">Tutorial in <code>tutorials/advanced/makefiles/maketest.py</code>.</a></li>
</ul>
<blockquote>
<p>First, if you’re using any build system other than SingleSource, you must set the executable attribute of the test, because ReFrame cannot know what is the actual executable to be run. We then set the build system to Make and set the preprocessor flags as we would do with the SingleSource build system.</p>
</blockquote>
<hr />
<h3 id="autotools"><a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/tutorial_advanced.html#adding-a-configuration-step-before-compiling-the-code">Autotools</a></h3>
<blockquote>
<p>It is often the case that a configuration step is needed before compiling a code with make. To address this kind of projects, ReFrame aims to offer specific abstractions for “configure-make” style of build systems. It supports CMake-based projects through the CMake build system, as well as Autotools-based projects through the Autotools build system.</p>
</blockquote>
<ul>
<li><a href="https://github.com/ntegan/amhello">Automake Hello example</a></li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reframe</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rfm</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reframe.utility.sanity</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sn</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">AutoHelloTest</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">RegressionTest</span><span class="p">):</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    <span class="n">sourcesdir</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/ntegan/amhello.git&#39;</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>    <span class="n">build_system</span> <span class="o">=</span> <span class="s1">&#39;Autotools&#39;</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>    <span class="n">executable</span> <span class="o">=</span> <span class="s1">&#39;./src/hello&#39;</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    <span class="n">prebuild_cmds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;autoreconf --install .&#39;</span><span class="p">]</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    <span class="n">time_limit</span> <span class="o">=</span> <span class="s1">&#39;5m&#39;</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>    <span class="nd">@sanity_function</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assert_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>        <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_found</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Hello world\!&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h3 id="cmake"><a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/regression_test_api.html#reframe.core.buildsystems.CMake">CMake</a></h3>
<ul>
<li><a href="https://github.com/jameskbride/cmake-hello-world">CMake Hello example</a></li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reframe</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rfm</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reframe.utility.sanity</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sn</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">CMakeHelloTest</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">RegressionTest</span><span class="p">):</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>    <span class="n">sourcesdir</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/jameskbride/cmake-hello-world.git&#39;</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>    <span class="n">build_system</span> <span class="o">=</span> <span class="s1">&#39;CMake&#39;</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="n">executable</span> <span class="o">=</span> <span class="s1">&#39;./CMakeHelloWorld&#39;</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>    <span class="n">time_limit</span> <span class="o">=</span> <span class="s1">&#39;5m&#39;</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>    <span class="nd">@sanity_function</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assert_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>        <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_found</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Hello, world\!&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h3 id="spack"><a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/regression_test_api.html#reframe.core.buildsystems.Spack">Spack</a></h3>
<ul>
<li>ReFrame will use a user-provided Spack environment in order to build and test a set of specs.</li>
<li><a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/tutorial_build_automation.html#using-spack-to-build-the-test-code">Tutorial in <code>tutorials/build_systems/spack/spack_test.py</code></a></li>
<li>In <code>rfm_job.out</code> you can see that it<ul>
<li>Creates a blank environment</li>
<li>Builds all dependencies -- takes quite long</li>
</ul>
</li>
<li><code>excalibur-tests</code> provides utilities and settings for Spack builds in ReFrame. See the <a href="../excalibur-tests_tutorial/">Next Tutorial</a> for details.</li>
</ul>
<hr />
<h2 id="run-only-tests">Run-only tests</h2>
<p>If you don't wish to build your application in ReFrame (we recommend that you do!), you can define a run-only test.
Run-only tests derive from the <code>rfm.RunOnlyRegressionTest</code> class instead of <code>rfm.RegressionTest</code>.
Instead of a build system, you define an executable which reframe expects to find in <code>$PATH</code>.
See <a href="https://reframe-hpc.readthedocs.io/en/v4.5.2/tutorial_advanced.html#writing-a-run-only-regression-test">tutorial in <code>tutorials/advanced/runonly/echorand.py</code></a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5090c770.min.js"></script>
      
    
  </body>
</html>